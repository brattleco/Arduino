// final program for blue player
//shoot for blue player
// left and right blue player
boolean flag = 0;
int motorpin1 = 3;  
int EnA = 5;
int motorpin2 = 6;

int motorpin3 = 9;  
int EnB = 10;
int motorpin4 = 11;

int incomingByte = 0;


#include <MPU6050.h>

 MPU6050 sensor ;
 
 int16_t ax, ay, az ;
 int16_t gx, gy, gz ;

void setup()
{

  //----------------- gyro -------------
Serial.begin  (115200); 
Serial.println  ( "Initializing the sensor" ); 
sensor.initialize ( ); 
Serial.println (sensor.testConnection ( ) ? "Successfully Connected" : "Connection failed"); 
delay (1000); 
Serial.println ( "Taking Values from the sensor" );
delay (1000);
//----------------------------------------

  pinMode(motorpin1,OUTPUT);
  pinMode(EnA,OUTPUT);
  pinMode(motorpin2,OUTPUT);
  
  pinMode(motorpin3, OUTPUT);
  pinMode (EnB,OUTPUT );
  pinMode (motorpin4,OUTPUT);

  pinMode(4,INPUT);
  pinMode(12,INPUT);
  pinMode(7, INPUT);
  
//  pinMode(13,OUTPUT);  

  pinMode(14,OUTPUT);  // reset pin

}
void loop()
{
 // digitalWrite(13,LOW);  

//------------- gyro -------------
sensor.getMotion6 (&ax, &ay, &az, &gx, &gy, &gz);
ax = map (ax, -17000, 17000, -180, 180) ;
Serial.println (ax);

//-------------------------------------
      //back red player after shoot
        if (ax >= -170 && ax <= -10){
      in(0,200,200);
    }else{
      in(0,0,0);
      
//      Reset
 //     digitalWrite(12,HIGH);
   //   delay(50);
      
     // digitalWrite(12,LOW);
     // delay(100);
      
    }
    
    // back again red player after shoot, for correction
    if (ax >= 60 && ax<= 120){
      in(200,200,0);
    }
          
int left_red = digitalRead(12);
int right_red = digitalRead(4);
int key = digitalRead(7);

if (key == HIGH){
  flag = 1;
  shootB();
  delay(50);
  if (flag == 1){
  digitalWrite(14,HIGH);
  delay(20);
  digitalWrite(14,LOW);
  delay(20);
}
}

if (left_red == HIGH )
{ 
    in(0,0,0);
    out(0,255,255);
    delay(10);
    out(0,0,0);
}
if (left_red == LOW )
{ 
    out(0,0,0);
  //  delay(200);
}
if (right_red == HIGH){
  in(0,0,0);
  out(255,255,0);
  delay(10);
  out(0,0,0);
}
if (right_red == LOW )
{ 
    out(0,0,0);
 //   delay(200);
}
} 

void out (int motorpin1val , int EnAval , int motorpin2val) {
  analogWrite (motorpin1 , motorpin1val);
   analogWrite (EnA , EnAval);
    analogWrite (motorpin2 , motorpin2val);
}

void in (int motorpin3val , int EnBval , int motorpin4val) {
  analogWrite (motorpin3 , motorpin3val);
   analogWrite (EnB , EnBval);
    analogWrite (motorpin4 , motorpin4val);
}

void shootB(){
  
    in(0,255,255);
    delay(250);
    
    in(0,0,0);
     delay(1000);
     
     in(255,255,0);
     delay(400);
     
     in(0,0,0);
     delay(200);

    incomingByte = 'd';
 
}
